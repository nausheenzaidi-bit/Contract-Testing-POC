# Pact Architecture for Your Federated GraphQL

## Your Current Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App â”‚     â”‚   Web App   â”‚     â”‚ Internal    â”‚
â”‚  (Consumer) â”‚     â”‚  (Consumer) â”‚     â”‚ Tools       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  GraphQL       â”‚
                  â”‚  Gateway       â”‚
                  â”‚  (Apollo)      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CMS API    â”‚    â”‚ LiveLike    â”‚    â”‚  Stats API  â”‚
â”‚ (Provider)  â”‚    â”‚    API      â”‚    â”‚ (Provider)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    ... 12 more subgraphs ...
```

**Problem:** How do we ensure these services can communicate without breaking?

---

## Pact Architecture (What We're Adding)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Pact Broker                            â”‚
â”‚  (Central Contract Registry - Docker or PactFlow)           â”‚
â”‚                                                             â”‚
â”‚  Stores:                                                    â”‚
â”‚  - Contracts (JSON files)                                   â”‚
â”‚  - Verification results                                     â”‚
â”‚  - Version history                                          â”‚
â”‚  - Can-I-Deploy status                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–²
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
          â”‚ Publish        â”‚ Verify         â”‚ Query
          â”‚ Contracts      â”‚ Contracts      â”‚ Status
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Consumer      â”‚  â”‚    Provider     â”‚  â”‚    CI/CD        â”‚
â”‚   Tests         â”‚  â”‚  Verification   â”‚  â”‚  Pipeline       â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚  Mobile App     â”‚  â”‚  GraphQL        â”‚  â”‚  can-i-deploy   â”‚
â”‚  writes tests   â”‚  â”‚  Gateway        â”‚  â”‚  checks         â”‚
â”‚  with expected  â”‚  â”‚  verifies it    â”‚  â”‚  before         â”‚
â”‚  responses      â”‚  â”‚  can satisfy    â”‚  â”‚  deployment     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Pact Workflow (Step by Step)

### Step 1: Consumer Defines Contract

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App Developer writes test:                         â”‚
â”‚                                                             â”‚
â”‚  "When I query getArticleBySlug with slug='news-123',      â”‚
â”‚   I expect to receive:                                     â”‚
â”‚   {                                                         â”‚
â”‚     title: 'Breaking News',                                â”‚
â”‚     slug: 'news-123',                                      â”‚
â”‚     publishedDate: '2024-01-15'                            â”‚
â”‚   }"                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    Pact generates
                    contract.json
```

### Step 2: Publish to Broker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CI/CD Pipeline:                                            â”‚
â”‚                                                             â”‚
â”‚  $ pact-broker publish ./pacts \                           â”‚
â”‚      --consumer-app-version=1.2.3 \                        â”‚
â”‚      --broker-base-url=https://broker                      â”‚
â”‚                                                             â”‚
â”‚  âœ… Contract published!                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Pact Broker   â”‚
                  â”‚                â”‚
                  â”‚  MobileApp     â”‚
                  â”‚  v1.2.3        â”‚
                  â”‚  â†”             â”‚
                  â”‚  GraphQLGatewayâ”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Provider Verification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GraphQL Gateway CI/CD:                                     â”‚
â”‚                                                             â”‚
â”‚  1. Fetch contracts from broker                            â”‚
â”‚  2. Set up provider state:                                 â”‚
â”‚     "article with slug news-123 exists"                    â”‚
â”‚     â†’ db.insert({ slug: 'news-123', ... })                 â”‚
â”‚                                                             â”‚
â”‚  3. Replay request from contract:                          â”‚
â”‚     POST /graphql                                           â”‚
â”‚     { query: "{ getArticleBySlug(...) }" }                 â”‚
â”‚                                                             â”‚
â”‚  4. Validate response matches expectations                 â”‚
â”‚                                                             â”‚
â”‚  âœ… Verification passed!                                    â”‚
â”‚  ğŸ“¤ Publish result to broker                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Can-I-Deploy Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Before deploying MobileApp v1.2.3 to production:          â”‚
â”‚                                                             â”‚
â”‚  $ pact-broker can-i-deploy \                              â”‚
â”‚      --pacticipant=MobileApp \                             â”‚
â”‚      --version=1.2.3 \                                     â”‚
â”‚      --to-environment=production                           â”‚
â”‚                                                             â”‚
â”‚  Checking...                                                â”‚
â”‚  âœ… GraphQLGateway v2.1.0 verified MobileApp v1.2.3        â”‚
â”‚  âœ… All contracts satisfied                                 â”‚
â”‚  âœ… Safe to deploy!                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Contract Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mobile App   â”‚
â”‚ Developer    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Writes test with
       â”‚    expected response
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pact Test    â”‚
â”‚ Framework    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Generates
       â”‚    contract.json
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Contract     â”‚
â”‚ File         â”‚
â”‚ (JSON)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Publish
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pact Broker  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
       â”‚                       â”‚
       â”‚ 4. Fetch              â”‚ 6. Publish
       â”‚    contracts          â”‚    result
       â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ Provider     â”‚               â”‚
â”‚ Verification â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Tests        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Verify
       â”‚    provider
       â”‚    satisfies
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GraphQL      â”‚
â”‚ Gateway      â”‚
â”‚ (Real Code)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Your Federated GraphQL with Pact

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Pact Broker    â”‚
                    â”‚  (Central)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
    Contracts          Contracts          Contracts
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mobile App    â”‚  â”‚    Web App      â”‚  â”‚ Internal Tools  â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚  Defines what   â”‚  â”‚  Defines what   â”‚  â”‚  Defines what   â”‚
â”‚  it expects     â”‚  â”‚  it expects     â”‚  â”‚  it expects     â”‚
â”‚  from Gateway   â”‚  â”‚  from Gateway   â”‚  â”‚  from Gateway   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  GraphQL        â”‚
                    â”‚  Gateway        â”‚
                    â”‚                 â”‚
                    â”‚  Verifies it    â”‚
                    â”‚  can satisfy    â”‚
                    â”‚  all consumers  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
    Contracts          Contracts          Contracts
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CMS API       â”‚  â”‚  LiveLike API   â”‚  â”‚   Stats API     â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚  Verifies it    â”‚  â”‚  Verifies it    â”‚  â”‚  Verifies it    â”‚
â”‚  can satisfy    â”‚  â”‚  can satisfy    â”‚  â”‚  can satisfy    â”‚
â”‚  Gateway        â”‚  â”‚  Gateway        â”‚  â”‚  Gateway        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        ... 12 more ...
```

---

## CI/CD Integration

### Consumer Pipeline (Mobile App)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App CI/CD Pipeline                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Run unit tests                                          â”‚
â”‚  2. Run Pact consumer tests  â—„â”€â”€ Generates contracts       â”‚
â”‚  3. Publish contracts to broker                             â”‚
â”‚  4. Build app                                               â”‚
â”‚  5. Can-I-Deploy check       â—„â”€â”€ Check if safe             â”‚
â”‚  6. Deploy (if âœ…)                                          â”‚
â”‚  7. Record deployment                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Provider Pipeline (GraphQL Gateway)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GraphQL Gateway CI/CD Pipeline                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Run unit tests                                          â”‚
â”‚  2. Fetch contracts from broker                             â”‚
â”‚  3. Run Pact provider verification  â—„â”€â”€ Verify contracts   â”‚
â”‚  4. Publish verification results                            â”‚
â”‚  5. Build service                                           â”‚
â”‚  6. Can-I-Deploy check                                      â”‚
â”‚  7. Deploy (if âœ…)                                          â”‚
â”‚  8. Record deployment                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Contract Example

### Consumer Test (Mobile App)

```typescript
// mobile-app/tests/graphql-gateway.pact.test.ts

describe('GraphQL Gateway Contract', () => {
  it('fetches article by slug', async () => {
    // Define the contract
    await pact
      .given('article with slug news-123 exists')
      .uponReceiving('a request for article by slug')
      .withRequest({
        method: 'POST',
        path: '/graphql',
        headers: { 'Content-Type': 'application/json' },
        body: {
          query: `query { getArticleBySlug(slug: "news-123") { title slug } }`
        }
      })
      .willRespondWith({
        status: 200,
        headers: { 'Content-Type': 'application/json' },
        body: {
          data: {
            getArticleBySlug: {
              title: 'Breaking News',
              slug: 'news-123'
            }
          }
        }
      });

    // Test your actual consumer code
    const result = await fetchArticle('news-123');
    expect(result.title).toBe('Breaking News');
  });
});
```

### Provider Verification (GraphQL Gateway)

```typescript
// graphql-gateway/tests/pact-verification.test.ts

describe('Pact Verification', () => {
  it('verifies contracts from consumers', async () => {
    await new Verifier({
      provider: 'GraphQLGateway',
      providerBaseUrl: 'http://localhost:4000',
      
      // Fetch contracts from broker
      pactBrokerUrl: 'https://broker.example.com',
      
      // Set up provider states
      stateHandlers: {
        'article with slug news-123 exists': async () => {
          // Seed test data
          await db.articles.insert({
            slug: 'news-123',
            title: 'Breaking News',
            publishedDate: '2024-01-15'
          });
        }
      },
      
      // Publish results
      publishVerificationResult: true,
      providerVersion: process.env.GIT_SHA
    }).verifyProvider();
  });
});
```

---

## Deployment Safety

### Without Pact

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deploy      â”‚
â”‚ Mobile App  â”‚
â”‚ v1.2.3      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ğŸ¤ Hope it works
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production  â”‚
â”‚             â”‚
â”‚ ğŸ’¥ BREAKS!  â”‚
â”‚             â”‚
â”‚ Gateway     â”‚
â”‚ changed API â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### With Pact

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Try to      â”‚
â”‚ Deploy      â”‚
â”‚ Mobile App  â”‚
â”‚ v1.2.3      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Can-I-Deploy?
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pact Broker â”‚
â”‚             â”‚
â”‚ âŒ BLOCKED! â”‚
â”‚             â”‚
â”‚ Gateway     â”‚
â”‚ v2.1.0      â”‚
â”‚ hasn't      â”‚
â”‚ verified    â”‚
â”‚ contract    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Fix gateway first
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gateway     â”‚
â”‚ fixes API   â”‚
â”‚ & verifies  â”‚
â”‚ contract    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Now can-i-deploy?
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pact Broker â”‚
â”‚             â”‚
â”‚ âœ… SAFE!    â”‚
â”‚             â”‚
â”‚ All         â”‚
â”‚ contracts   â”‚
â”‚ verified    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Deploy!
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production  â”‚
â”‚             â”‚
â”‚ âœ… Works!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Benefits Visualization

### Traditional Testing

```
Unit Tests        Integration Tests         E2E Tests
   Fast               Slow                  Very Slow
   âœ…                 âš ï¸                     âŒ
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fast   â”‚        â”‚ Need full  â”‚        â”‚ Brittle      â”‚
â”‚ Cheap  â”‚        â”‚ environmentâ”‚        â”‚ Expensive    â”‚
â”‚ Focusedâ”‚        â”‚ Complex    â”‚        â”‚ Slow         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ Flaky      â”‚        â”‚ Hard to      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ maintain     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ Gap: No contract testing!
```

### With Pact

```
Unit Tests    Contract Tests    Integration Tests    E2E Tests
   Fast          Fast              Slow              Very Slow
   âœ…            âœ…                âš ï¸                 âŒ
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fast   â”‚    â”‚ Fast   â”‚      â”‚ Fewer      â”‚     â”‚ Minimal  â”‚
â”‚ Cheap  â”‚    â”‚ Cheap  â”‚      â”‚ needed     â”‚     â”‚ only     â”‚
â”‚ Focusedâ”‚    â”‚ Catchesâ”‚      â”‚ now        â”‚     â”‚ critical â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ breaks â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ paths    â”‚
              â”‚ early  â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Gap filled by Pact!
```

---

## Summary

**Pact adds a safety net between your services:**

1. âœ… **Consumers** define what they need
2. âœ… **Providers** verify they can deliver
3. âœ… **Broker** tracks compatibility
4. âœ… **CI/CD** prevents breaking deployments
5. âœ… **Team** deploys with confidence

**Result:** No more breaking changes in production! ğŸ‰

---

**For more details, see:**
- README.md - Implementation guide
- PRESENTATION_GUIDE.md - How to present this
- DEMO_SUMMARY.md - Overview
